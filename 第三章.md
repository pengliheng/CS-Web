# 运输层

如果说应用层是负责描述连接状态,那么传输层就是负责将数据安全可靠的运输到另一个进程,运输层大致分为 TCP UDP 传输协议,

## 感后感

**TCP 协议**经历过三次握手,所以说 TCP 协议是一个有状态的协议,它是在两个进程之间通讯,并且在互相确认过眼神之后才通讯的协议.TCP 运输层负责的内容就是要将数据安全可靠的传输给另一个进程, 没错, IP:端口 就是一个进程的描述,TCP 就是进程进程之间的通讯协议.当然 TCP 还拥有拥堵机制,以及重发机制, 换句话说,TCP 协议负责人将数据分割成一个个数据包,每个数据包不分先后到达另一个目标进程.不分数据包遗失,TCP 负责重新发送这个数据包,这个就是**滑动窗口协议**,数据包在一定时间内还没到达目标进程就会重发,而这个一定时间就是滑动窗口的宽度. **拥堵机制**就是当网络拥堵的时候就等一下再发送数据包,因为 TCP 有这些功能,所以 TCP 协议是靠谱的也是复杂的,我们的 HTTP 文本就是采用 TCP 协议发送.TCP 协议为了能够顺利组装到达的数据包,所以引入了一个序列号**ACK**

**UDP 协议**就简单很多,他没有拥堵机制,也不会重发,所以视频流会采用 UDP 协议发送,DNS 查询同样用 UDP 协议发送.原因就是它快,而且允许一定数据包丢失.

## 攻击

- 针对 UDP 的攻击**UDP Flood**

  UDP 洪泛是一种拒绝服务攻击，其中大量的用户数据报协议（UDP）数据包被发送到目标服务器，目的是压倒该设备的处理和响应能力。防火墙保护目标服务器也可能因 UDP 泛滥而耗尽，从而导致对合法流量的拒绝服务。

- 针对 TCP 的攻击 DDOS 分布式拒绝

  就是 TCP 三次握手过程中只握手第一次,第二次就不回应,导致 TCP 进程中一直维护这条连接.那么这到底和`SYN 泛洪攻击`有什么区别呢?下面介绍 DDOS 分布式拒绝攻击

## DDOS - 分布式拒绝攻击

- **ICMP Flood (分布式 ping)**

  短时间内向特定目标不断请求 ICMP 回应，致使目标系统负担过重而不能处理合法的传输任务，就发生了 ICMP Flood。启用 ICMP Flood 攻击检测功能时，要求设置一个连接速率阈值，一旦发现保护主机 ICMP 连接速率超过该值，防火墙会输出发生 ICMP Flood 攻击的告警日志，并且根据用户的配置可以阻止发往该主机的后续连接请求。

- **UDP Flood**

  短时间内向特定目标不断发送 UDP 报文，致使目标系统负担过重而不能处理合法的传输任务，就发生了 UDP Flood。启用 UDP Flood 攻击检测功能时，要求设置一个连接速率阈值，一旦发现保护主机响应的 UDP 连接速率超过该值，防火墙会输出发生 UDP Flood 攻击的告警日志，并且根据用户的配置可以阻止发往该主机的后续连接请求。

- **SYN Flood**

  由于资源的限制，TCP/IP 栈只能允许有限个 TCP 连接。SYN Flood 伪造 SYN 报文向服务器发起连接，服务器在收到报文后用 SYN_ACK 应答，此应答发出去后，不会收到 ACK 报文，造成一个半连接。若攻击者发送大量这样的报文，会在被攻击主机上出现大量的半连接，耗尽其资源，使正常的用户无法访问，直到半连接超时。在一些创建连接不受限制的实现里，SYN Flood 具有类似的影响，它会消耗掉系统的内存等资源。

## TCP 协议从客户发起到客户关闭

其实就是三次握手/四次分手啦,虽然我觉得这种描述非常片面,对理解不利,我们应该对整个开启连接关闭连接有一个整体理解,而不是片面理解

- CLOSE_STATUS
- 客户应用程序发起一个 TCP 连接 - 也就是 python 中建立 socket 的过程,
- 发送 SYN 第一次握手
- SYN_SENT 状态
- 接收 SYN & ACK, 并且发送 ACK 接收到客户端发来的 SYN 握手请求, 返回一个 ACK
- ESTABLISHED 已连接状态 - 完成三次握手
- 发送 FIN 发起关闭 TCP 连接请求. 第一次挥手, 客户应用程序发起关闭连接
- FIN_WAIT_1 状态
- 接受 ACK,不发送
- FIN_WAIT_2
- 接受 FIN,发送 ACK
- TIME_WAIT
- 等待 30s
- CLOSE_STATUS

## TCP 拥堵算法 (看不懂)

- 慢启动
- 拥塞避免
- 快速恢复

### TCP 拥塞算法举例

- BBR 新的拥塞算法

  [Linux Kernel 4.9 中的 BBR 算法与之前的 TCP 拥塞控制相比有什么优势？](https://www.zhihu.com/question/53559433)

- Reno 算法.
- TCPVegas 算法

### 总结

这章节只需要弄懂 UDP 和 TCP 传输协议即可, 另外 P2P 其实就是迅雷为什么能抢网速,原因就在于它使用的是 UDP 协议作为传输层的传输协议.没有拥堵机制,普通 TCP 协议之上的 HTTP 请求,看视频什么的自然抢不过它.
